import React, { useState, useEffect } from "react";
import { AgGridReact } from "ag-grid-react";
import "ag-grid-community/styles/ag-grid.css";
import "ag-grid-community/styles/ag-theme-quartz.css";
import "ag-grid-enterprise";
import "./apps.css";
import './App.css'
import { BiPlus } from "react-icons/bi";
//import "./grid.css"
import { useNavigate } from "react-router-dom";
import "bootstrap/dist/css/bootstrap.min.css";
import { FontAwesomeIcon } from '@fortawesome/react-fontawesome';
import swal from 'sweetalert2';
import Select from 'react-select';
import { Dropdown, DropdownButton } from 'react-bootstrap';
import InputCompany from './Input';
import AuditInfo from "./AdditionalData.js"; 

const config = require('./Apiconfig');


function Grid() {
  const [open2, setOpen2] = React.useState(false);
  const [rowData, setRowData] = useState([]);
  const [gridApi, setGridApi] = useState(null);
  const [gridColumnApi, setGridColumnApi] = useState(null);
  const [searchValue, setSearchValue] = useState("");
  const navigate = useNavigate();
  const [editedData, setEditedData] = useState([]);
  const [selectedRows, setSelectedRows] = useState([]);
  const [drop, setDrop] = useState([]);
  const [condrop, setCondrop] = useState([]);
  const [statedrop, setStatedrop] = useState([]);
  const [statusdrop, setStatusdrop] = useState([]);
  const [statusgriddrop, setStatusGriddrop] = useState([]);
  const [company_no, setCompany_no] = useState("");
  const [company_name, setCompany_name] = useState("");
  const [city, setCity] = useState("");
  const [state, setState] = useState(""); // Set default state value
  const [pincode, setPincode] = useState("");
  const [country, setCountry] = useState("");
  const [status, setStatus] = useState("");
  const [Locationdrop, setLocationdrop] = useState("")
  const [selectedStatus, setSelectedStatus] = useState(null);
  const [hasValueChanged, setHasValueChanged] = useState(false);
  const [additionalData, setAdditionalData] = useState({
    modified_by: '',
    created_by: '',
    modified_date: '',
    created_date: ''
  });
  //code added by Pavun purpose of set user permisssion
   const permissions = JSON.parse(sessionStorage.getItem('permissions')) || {};
   const companyPermissions = permissions
   .filter(permission => permission.screen_type === 'Company')
   .map(permission => permission.permission_type.toLowerCase());
 
 
  /*testing for search criteria*/
  /* const [showAddUserForm, setShowAddUserForm] = useState(false);
  const [editedData, setEditedData] = useState([]);
  const [startDate, setStartDate] = useState("");
  const [endDate, setEndDate] = useState("");*/

  // useEffect(() => {
  //   fetchData();
  // }, []);

  // const fetchData = async () => {
  //    try {
  //      const response = await fetch("http://localhost:5500/search ");
  //     const jsonData = await response.json();
  //     setRowData(jsonData);
  //   } catch (error) {
  //     console.error("Error fetching data:", error);
  //    }
  // };

  useEffect(() => {
    fetch(`${config.apiBaseUrl}/city`)
      .then((response) => response.json())
      .then((data) => {
        // Extract city names from the fetched data
        const cityNames = data.map(option => option.attributedetails_name);
        setDrop(cityNames);
      })
      .catch((error) => console.error('Error fetching data:', error));
  }, []);

  useEffect(() => {
    fetch(`${config.apiBaseUrl}/country`)
      .then((response) => response.json())
      .then((data) => {
        // Extract city names from the fetched data
        const countries = data.map(option => option.attributedetails_name);
        setCondrop(countries);
      })
      .catch((error) => console.error('Error fetching data:', error));
  }, []);

  useEffect(() => {
    fetch(`${config.apiBaseUrl}/state`)
      .then((response) => response.json())
      .then((data) => {
        // Extract city names from the fetched data
        const States = data.map(option => option.attributedetails_name);
        setStatedrop(States);
      })
      .catch((error) => console.error('Error fetching data:', error));
    }, []);

    useEffect(() => {
      fetch(`${config.apiBaseUrl}/locationno`)
        .then((response) => response.json())
        .then((data) => {
          // Extract city names from the fetched data
          const LocationOption = data.map(option => option.location_no);
          setLocationdrop(LocationOption);
        })
        .catch((error) => console.error('Error fetching data:', error));
    }, []);

  useEffect(() => {
    fetch(`${config.apiBaseUrl}/status`)
      .then((response) => response.json())
      .then((data) => {
        // Extract city names from the fetched data
        const statusOption = data.map(option => option.attributedetails_name);
        setStatusGriddrop(statusOption);
      })
      .catch((error) => console.error('Error fetching data:', error));
  }, []);

  useEffect(() => {
    fetch(`${config.apiBaseUrl}/status`)
      .then((data) => data.json())
      .then((val) => setStatusdrop(val));
  }, []);

  const filteredOptionStatus = statusdrop.map((option) => ({
    value: option.attributedetails_name,
    label: option.attributedetails_name,
  }));

  const handleChangeStatus = (selectedStatus) => {
    setSelectedStatus(selectedStatus);
    setStatus(selectedStatus ? selectedStatus.value : '');
    setHasValueChanged(true);
  };


  // useEffect(() => {
  //   fetch(`${config.apiBaseUrl}/city`)
  //     .then((data) => data.json())
  //     .then((val) => setDrop(val));
  // }, []);
  // useEffect(() => {
  //   fetch(`${config.apiBaseUrl}/country`)
  //     .then((data) => data.json())
  //     .then((values) => setCondrop(values));
  // }, []);
  // useEffect(() => {
  //   fetch(`${config.apiBaseUrl}/state`)
  //     .then((data) => data.json())
  //     .then((val) => setStatedrop(val));
  // }, []);

  // useEffect(() => {
  //   fetch(`${config.apiBaseUrl}/status`)
  //     .then((data) => data.json())
  //     .then((val) => setStatusdrop(val));
  // }, []);


  const handleCompanyNoChange = (event) => {
    setCompany_no(event.target.value);
  };

  const handleCompanyNameChange = (event) => {
    setCompany_name(event.target.value);
  };

  const handlecityChange = (event) => {
    setCity(event.target.value);
  };

  const handlestateChange = (event) => {
    setState(event.target.value);
  };



  const handlesetPincodeChange = (event) => {
    setPincode(event.target.value);
  };

  const handleCountryChange = (event) => {
    setCountry(event.target.value);
  };

  const handleStatusChange = (event) => {
    setStatus(event.target.value);
  };

  const reloadGridDatas = async () => {
    try {
      const response = await fetch(`${config.apiBaseUrl}/reloadGridData`); // Replace with the actual endpoint to reload grid data
      if (response.ok) {
        const gridData = await response.json();
        setRowData(gridData);
        console.log("Grid data reloaded successfully");
      } else {
        console.error("Failed to reload grid data");
        swal.fire({
          title: "Error!",
          text: "Failed to reload grid data. Please try again later",
          icon: "error",
          confirmButtonText: "OK"
        });
      }
    } catch (error) {
      console.error("Error reloading grid data:", error);
      swal.fire({
        title: "Error!",
        text: "An error occurred while reloading grid data. Please try again later",
        icon: "error",
        confirmButtonText: "OK"
      });
    }
  };

  const handleSearch = async () => {
    
    try {
      const response = await fetch(`${config.apiBaseUrl}/companysearchcriteria`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({ company_no, company_name, city, state, pincode, country, status }) // Send company_no and company_name as search criteria
      });
      if (response.ok) {
        const searchData = await response.json();
        setRowData(searchData);
        console.log(searchData)
        console.log("data fetched successfully")

      } else if (response.status === 404) {
        console.log("Data not found");
        swal.fire({
          title: "Data not found",
          text: "No data matching the search criteria",
          icon: "info",
          confirmButtonText: "OK"
        }); // Log the message for 404 Not Found
      } else {
        console.log("Bad request");
        swal.fire({
          title: "Error!",
          text: "An error occurred. Please try again later",
          icon: "error",
          confirmButtonText: "OK"
        });
      } // Log the message for other errors

    } catch (error) {
      console.error("Error fetching search data:", error);
      swal.fire({
        title: "Error!",
        text: "An error occurred while fetching data. Please try again later",
        icon: "error",
        confirmButtonText: "OK"
      });
    }
  };

  const reloadGridData = () => {
    window.location.reload();
  };




  const columnDefs = [

    {
      headerCheckboxSelection: true,
      headerName: "Code",
      field: "company_no",
      cellStyle: { textAlign: "left" },
      minWidth: 180,
      checkboxSelection: true,
      cellEditorParams: {
        maxLength: 18,
      },

    },
    {
      headerName: "Name",
      field: "company_name",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 200,
      cellEditorParams: {
        maxLength: 250,
      },
    },
    {
      headerName: "Short Name",
      field: "short_name",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 250,
      },
    },
    {
      headerName: "Address 1",
      field: "address1",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 250,
      },
    },
    {
      headerName: "Address 2",
      field: "address2",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 250,
      },
    },
    {
      headerName: "Address 3",
      field: "address3",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 250,
      },
    },
    /*{
      headerName: "City",
      field: "city",
      cellStyle: { textAlign: "center" },
      minWidth: 150,
      cellRenderer: "popupCellRenderer",
      cellRendererParams: {
        values: drop,
      }
    }, */
    {
      headerName: "City",
      field: "city",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditor: "agSelectCellEditor",
      cellEditorParams: {
        values: drop,
       
      },

    },
    {
      headerName: "State",
      field: "state",
      editable: true,
      cellStyle: { textAlign: "left" },
        minWidth: 150,    
        cellEditor: "agSelectCellEditor",
        cellEditorParams: {
          values: statedrop,
        },
    },
    {
      headerName: "Pin Code",
      field: "pincode",
      editable: true,
      type: Number,
      cellStyle: { textAlign: "right" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 100,
      },
    },
    {
      headerName: "Country",
      field: "country",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditor: "agSelectCellEditor",
      cellEditorParams: {
        values: condrop,
      },
    },
    {
      headerName: "Email ID",
      field: "email_id",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 250,
      },
    },

    {
      headerName: "Status",
      field: "status",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditor: "agSelectCellEditor",
      cellEditorParams: {
        values: statusgriddrop
      },
      
    },
    {
      headerName: "Founded Date",
      field: "foundedDate",
      filter: "agDateColumnFilter",
      editable: true,
      cellStyle: { textAlign: "center" },
      minWidth: 150,
    },
    {
      headerName: "URL",
      field: "websiteURL",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 150,
      },
    },
    // {
    //   headerName: "Logo",
    //   field: "Company_logo",

    //   editable: true,
    //   cellStyle: { textAlign: "center" },
    //   minWidth: 150,
    // },
    {
      headerName: "Contact No",
      field: "contact_no",
      editable: true,
      cellEditor: "numericCellEditor",
      cellStyle: { textAlign: "right" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 50,
      },
    },
    // {
    //   headerName: "CEO",
    //   field: "CEOName",
    //   editable: true,
    //   cellStyle: { textAlign: "center" },
    //   minWidth: 150,
    // },
    {
      headerName: "Annual Report URL",
      field: "AnnualReportURL",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditorParams: {
        maxLength: 150,
      },
    },
    {
      headerName: "Location No",
      field: "location_no",
      editable: true,
      cellStyle: { textAlign: "left" },
      minWidth: 150,
      cellEditor: "agSelectCellEditor",
      cellEditorParams: {
        values: Locationdrop,
      },
    },
  ];

  const defaultColDef = {
    resizable: true,
    wrapText: true,
    // sortable: true,
    //editable: true,
    flex: 1,
    // filter: true,
    // floatingFilter: true,
  };

  const onGridReady = (params) => {
    setGridApi(params.api);
    setGridColumnApi(params.columnApi);
  };


  const generateReport = () => {
    const selectedRows = gridApi.getSelectedRows();
    if (selectedRows.length === 0) {
      alert("Please select at least one row to generate a report");
      return;
    }
  
    const reportData = selectedRows.map((row) => {
      return {
        "Company No": row.company_no,
        "Company Name": row.company_name,
        "Short Name": row.short_name,
        Address: `
          ${row.address1 || ''},
          ${row.address2 || ''},  
          ${row.address3 || ''},<br>
          ${row.city || ''},<br>
          ${row.pincode || ''},<br>
          ${row.state || ''},<br>
          ${row.country || ''}`,
        "Email Id": row.email_id,
        Status: row.status,
        "Founded Date": row.FoundedDate,
        "Website URL": row.WebsiteURL,
        "Contact No": row.contact_no,
        "CEO Name": row.CEOName,
        "Annual Report URL": row.AnnualReportURL
      };
    });
  
    const reportWindow = window.open("", "_blank");
    reportWindow.document.write("<html><head><title>Company Report</title>");
    reportWindow.document.write("<style>");
    reportWindow.document.write(`
      body {
          font-family: Arial, sans-serif;
          margin: 20px;
      }
      h1 {
          color: maroon;
          text-align: center;
          font-size: 24px;
          margin-bottom: 30px;
          text-decoration: underline;
      }
      table {
          width: 100%;
          border-collapse: collapse;
          margin-bottom: 20px;
      }
      th, td {
          padding: 10px;
          text-align: left;
          border: 1px solid #ddd;
          vertical-align: top;
      }
      th {
          background-color: maroon;
          color: white;
          font-weight: bold;
      }
      td {
          background-color: #fdd9b5;
      }
      tr:nth-child(even) td {
          background-color: #fff0e1;
      }
      .report-button {
          display: block;
          width: 150px;
          margin: 20px auto;
          padding: 10px;
          background-color: maroon;
          color: white;
          border: none;
          cursor: pointer;
          font-size: 16px;
          text-align: center;
          border-radius: 5px;
      }
      .report-button:hover {
          background-color: darkred;
      }
      @media print {
          .report-button {
              display: none;
          }
          body {
              margin: 0;
              padding: 0;
          }
      }
    `);
    reportWindow.document.write("</style></head><body>");
    reportWindow.document.write("<h1><u>Company Information</u></h1>");
  
    // Create table with headers
    reportWindow.document.write("<table><thead><tr>");
    Object.keys(reportData[0]).forEach((key) => {
      reportWindow.document.write(`<th>${key}</th>`);
    });
    reportWindow.document.write("</tr></thead><tbody>");
  
    // Populate the rows
    reportData.forEach((row) => {
      reportWindow.document.write("<tr>");
      Object.values(row).forEach((value) => {
        reportWindow.document.write(`<td>${value}</td>`);
      });
      reportWindow.document.write("</tr>");
    });
  
    reportWindow.document.write("</tbody></table>");
  
    reportWindow.document.write(
      '<button class="report-button" onclick="window.print()">Print</button>'
    );
    reportWindow.document.write("</body></html>");
    reportWindow.document.close();
  };
  
  

  const handleNavigateToForm = () => {
    navigate("/AddCompany", { selectedRows }); // Pass selectedRows as props to the Input component
  };

  const onSelectionChanged = () => {
    const selectedNodes = gridApi.getSelectedNodes();
    const selectedData = selectedNodes.map((node) => node.data);
    setSelectedRows(selectedData);
    
  };
  // Assuming you have a unique identifier for each row, such as 'id'
  const onCellValueChanged = (params) => {
    const updatedRowData = [...rowData];
    const rowIndex = updatedRowData.findIndex(
      (row) => row.company_no === params.data.company_no // Use the unique identifier 
    );
    if (rowIndex !== -1) {
      updatedRowData[rowIndex][params.colDef.field] = params.newValue;
      setRowData(updatedRowData);

      // Add the edited row data to the state
      setEditedData((prevData) => [...prevData, updatedRowData[rowIndex]]);
    }
  };


  const saveEditedData = async () => {
    try {
      const modified_by = sessionStorage.getItem('selectedUserCode');
      // Filter the editedData state to include only the selected rows
      const selectedRowsData = editedData.filter(row => selectedRows.some(selectedRow => selectedRow.company_no === row.company_no));

      const response = await fetch(`${config.apiBaseUrl}/saveEditedData`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Modified-By": modified_by
        },
        body: JSON.stringify({ editedData: selectedRowsData }), // Send only the selected rows for saving
        "modified_by": modified_by 
      });

      if (selectedRowsData.length === 0) {
        swal.fire({
          title: "No Rows Selected",
          text: "Please select a row to update its data",
          icon: "warning",
          confirmButtonText: "OK"
        });
        return;
      }
      const saveConfirmation = await swal.fire({
        title: "Confirm Update",
        text: "Are you sure you want to update the data in the selected rows?",
        icon: "question",
        showCancelButton: true,
        confirmButtonText: "Yes",
        cancelButtonText: "No"
      });

      if (!saveConfirmation.value) {
        return;
      }

      if (response.status === 200) {
        setTimeout(() => {
          swal.fire({
                text: "Data updated successfully!",
                icon: "success",
                timer: 1000,
                timerProgressBar: true,
                showConfirmButton: false,
                //   customClass: {
                //     popup: 'my-custom-size',
                // }
            }).then(() => {
              handleSearch();
            });
        }, 1000);
        return;

      } else {
        console.error("Failed to save data");
        swal.fire({
          title: "Error!",
          text: "Failed to update data. Please try again later",
          icon: "error",
          confirmButtonText: "OK"
        });
      }
    } catch (error) {
      console.error("Error saving data:", error);
      swal.fire({
        title: "Error!",
        text: "An error occurred while saving data. Please try again later",
        icon: "error",
        confirmButtonText: "OK"
      });

    }
  };


  const deleteSelectedRows = async () => {
    const selectedRows = gridApi.getSelectedRows();

    if (selectedRows.length === 0) {
      swal.fire({
        title: "No Rows Selected",
        text: "Please select at least one row to delete",
        icon: "warning",
        confirmButtonText: "OK"
      });
      return;
    }

    const confirmDelete = await swal.fire({
      title: "Confirm Delete",
      text: "Are you sure you want to delete the selected rows?",
      icon: "question",
      showCancelButton: true,
      confirmButtonText: "Yes",
      cancelButtonText: "No"
    });
    if (!confirmDelete.isConfirmed) {
      return;
    }
    const modified_by = sessionStorage.getItem('selectedUserCode');
    const company_nosToDelete = selectedRows.map((row) => row.company_no);

    try {
      const response = await fetch(`${config.apiBaseUrl}/delete`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json",
          "Modified-By": modified_by
        },
        body: JSON.stringify({ company_nos: company_nosToDelete }),
        "modified_by": modified_by
      });

      if (response.ok) {
        console.log("Rows deleted successfully:", company_nosToDelete);
        handleSearch(); // Fetch updated data after deletion
        swal.fire({
          title: "Success",
          text: "Rows deleted successfully",
          icon: "success",
          confirmButtonText: "OK"
        });
      } else {
        // Check if the response status is 400 for custom error handling
        if (response.status === 400) {
          const errorMessage = await response.text(); // Extract error message from response
          swal.fire({
            title: "Error",
            text: errorMessage,
            icon: "error",
            confirmButtonText: "OK"
          }); // Display error message to the user
        } else {
          console.error("Failed to delete rows");
        }
      }
    } catch (error) {
      console.error("Error deleting rows:", error);
      // Handle network errors or other exceptions
      swal.fire({
        title: "Error",
        text: "An error occurred while deleting rows. Please try again later",
        icon: "error",
        confirmButtonText: "OK"
      });
    }
  };

  const handlesetPincode = (e) => {
    const value = e.target.value;
    if (value.length <= 10) {  // Ensure length is 10 or less
      setPincode(value);
    }
  };
  const handleKeyDownStatus = async (e) => {
    if (e.key === 'Enter' && hasValueChanged) { // Only trigger search if the value has changed
      await handleSearch(); // Trigger the search function
      setHasValueChanged(false); // Reset the flag after search
    }
  };

  const handleShowModal = () => {
    setOpen2(true);
  };
  const handleClickOpen = (params) => {
    setOpen2(true);
    console.log('Opening popup...');
  };
  const handleClose = () => {
  
    setOpen2(false);
   
  };



  const fetchAdditionalData = async (company_no) => {
    try {
      const response = await fetch(`${config.apiBaseUrl}/AdditionalData`, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({ company_no }), 
      });
      
      const result = await response.json();
      setAdditionalData({
        modified_by: result.modified_by,
        created_by: result.created_by,
        modified_date: result.modified_date,
        created_date: result.created_date
      });
    } catch (error) {
      console.error("Error fetching additional data:", error);
    }
  };

  // Handler for when a row is selected
  const onRowSelected = (event) => {
    if (event.node.isSelected()) {
      setSelectedRows(event.data);
      fetchAdditionalData(event.data); // Fetch additional data on row selection
    }
  };


  return (
    <div className="container-fluid Topnav-screen">

      <div>
      <div className="shadow-lg p-1 bg-body-tertiary rounded  mb-2 mt-2">
        <div  className=" d-flex justify-content-between " >
         <div className="d-flex justify-content-start"> 
         <h1 align="left" className="purbut me-5">Company</h1>
         </div>
          <div className="d-flex justify-content-end purbut me-3">
            {['add', 'all permission'].some(permission => companyPermissions.includes(permission)) && (
              <addbutton  className="purbut" onClick={handleClickOpen}
              ><i class="fa-solid fa-user-plus"></i>
           </addbutton>
            )}
            {['delete', 'all permission'].some(permission => companyPermissions.includes(permission)) && (
              <delbutton className="purbut" onClick={deleteSelectedRows} required title="Delete">
                <i class="fa-solid fa-user-minus"></i>
              </delbutton>
            )}
            {['update', 'all permission'].some(permission => companyPermissions.includes(permission)) && (
              <savebutton  className="purbut" onClick={saveEditedData} required title="Update"><i class="fa-solid fa-floppy-disk"></i>

              </savebutton>
            )}


            {/* <div class="d-flex flex-row my-2 mt-3 ">
          <button  onClick={} title="print"><i class="fa fa-print" aria-hidden="true"></i></button>

        
         */}
          {['all permission', 'view'].some(permission => companyPermissions.includes(permission)) && (
        <printbutton  className="purbut" onClick={generateReport}  required title="Generate Report"> <i class="fa-solid fa-print"></i></printbutton>
      )}
</div></div>




<div class="dingdong">
          <div class="d-flex justify-content-between ">
          <div className="d-flex justify-content-start"> 
         <h1 align="left" className="me-5">
          Company</h1>
         </div>
            <div class="dropdown mt-2 me-5" style={{paddingLeft:0}}>
              <button class="btn btn-primary dropdown-toggle p-1" type="button" data-bs-toggle="dropdown" aria-expanded="false">
                <i class="fa-solid fa-list"></i>
              </button>
              <ul class="dropdown-menu menu">
                <li class="me-5 ms-4">
                  {['add', 'all permission'].some(permission => companyPermissions.includes(permission)) && (
                    <button class="btn btn-secondary me-3 fs-6 mobile" onClick={handleClickOpen}>Add</button>
                  )}
                </li>
                <li class="me-5 ms-4">
                  {['delete', 'all permission'].some(permission => companyPermissions.includes(permission)) && (
                    <button class="btn btn-danger me-3 mt-2 fs-6 mobile" onClick={deleteSelectedRows} >Delete</button>
                  )}
                </li>
                <li class="me-5 ms-4">
                  {['update', 'all permission'].some(permission => companyPermissions.includes(permission)) && (
                    <button class="btn btn-success me-3 mt-2 fs-6 text-white mobile" onClick={saveEditedData}>Update</button>
                  )}
                </li>
                <li class="me-5 ms-4">
                  {['all permission', 'view'].some(permission => companyPermissions.includes(permission)) && (
                    <button class="btn btn-dark mt-2 text-white mobile" onClick={generateReport}>Print</button>
                  )}
                </li>
              </ul>
            </div>
          </div></div>

</div>
       

       
        
        <div className="shadow-lg p-1 bg-body-tertiary rounded  pt-4 " align="left">
          {/* <p>Search Criteria</p> */}
        <div className="row ms-3 me-3">
            <div className="col-md-3 form-group">
              <div class="exp-form-floating">
                
              <label for="cname" class="exp-form-labels">
                  Company No
                </label>
                <input
                  id="cno"
                  className="exp-input-field form-control"
                  type="text"
                  placeholder=""
                  required title="Please fill the company number here"
                  value={company_no}
                  onChange={handleCompanyNoChange}
                  onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                  maxLength={18}
                />
                
              </div>
            </div>
            <div className="col-md-3 form-group">
              <div class="exp-form-floating">
              <label for="cname" class="exp-form-labels">
                  Company Name
                </label>
                <input
                  id="cname"
                  className="exp-input-field form-control"
                  type="text"
                  placeholder=""
                  required title="Please fill the company name here"
                  value={company_name}
                  onChange={handleCompanyNameChange}
                  onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                  maxLength={250}
                />
                
              </div>
            </div>
            <div className="col-md-3 form-group">
              <div class="exp-form-floating">
               <label for="city" class="exp-form-labels">
                  City
                </label><input
                id="city"
                className="exp-input-field form-control"
                   type="text"
                placeholder=""
                required title="Please fill the city here" 
                value={city}
                onChange={(e) => setCity(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                maxLength={100}
                />
               
              </div>
            </div>

            <div className="col-md-3 form-group">
              <div class="exp-form-floating">
               <label for="state" class="exp-form-labels">
                  State
                </label><input
                id="state"
                className="exp-input-field form-control"
                type="text"
                placeholder=""
                required title="Please fill the state here" 
                value={state}
                onChange={(e) => setState(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                maxLength={100}
                />
               
              </div>
            </div>
            <div className="col-md-3 form-group">
  <div className="exp-form-floating">
    <label htmlFor="pin" className="exp-form-labels">
      Pin Code
    </label>
    <input
      id="pin"
      className="exp-input-field form-control"
      type="text"  // Changed to text to enforce maxLength
      placeholder=""
      required
      title="Please fill the Pin Code here"
      value={pincode}
      maxLength={10} // Set the max length to 10
      onChange={handlesetPincode}
      onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
    />
  </div>
</div>

            <div className="col-md-3 form-group">
              <div class="exp-form-floating">
              <label for="country" class="exp-form-labels">
                  Country
                </label><input
                id="country"
                className="exp-input-field form-control"
                 type="text"
                placeholder=""
                required title="Please fill the country here" 
                value={country}
                onChange={(e) => setCountry(e.target.value)}
                onKeyDown={(e) => e.key === 'Enter' && handleSearch()}
                />
                
              </div>
            </div>
            <div className="col-md-3 form-group">
              <div class="exp-form-floating">
              <label  class="exp-form-labels">
                  Status
                </label>
                {/* <select
                  name="status"
                  id="status"
                  className="exp-input-field form-control"
                  placeholder="Select status"
                  required title="Please select a status"
                  value={status}
                  onChange={(e) => setStatus(e.target.value)}
                    
                  autoComplete="off"
                >
                  <option value=""></option>
        {statusdrop.map((option, index) => (
          <option key={index} value={option}>
            {option}
          </option>
                  ))}
                </select> */}
               <Select
                id="status"
                value={selectedStatus}
                onChange={handleChangeStatus}
                onKeyDown={handleKeyDownStatus}
                options={filteredOptionStatus}
                className="exp-input-field"
                placeholder=""
              />
                
              </div>
               </div>
             
       
            
        <div className="col-md-2 form-group mt-4">
        <div class="exp-form-floating">
            <div class=" d-flex  justify-content-center"> 
          
           <div class=''><button className="me-4"  onClick={handleSearch}required title="Search"><i className="fas fa-search"></i></button></div>
           <div><button className=""  onClick={reloadGridData}required title="Refresh"><FontAwesomeIcon icon="fa-solid fa-arrow-rotate-right" /></button></div>
           </div> </div></div>
            </div>
       
          
          
           <p >Result Set</p>
       
        
   
       
      
        <div class="ag-theme-alpine"  style={{height: 455, width:"100%"}}>
          <AgGridReact
            rowData={rowData}
            columnDefs={columnDefs}
            defaultColDef={defaultColDef}
            onGridReady={onGridReady}
            onCellValueChanged={onCellValueChanged}
            rowSelection="single"
            onSelectionChanged={onSelectionChanged}
            pagination={true}
            paginationAutoPageSize={true}
            onRowSelected={onRowSelected}
          /></div>
        </div>
      </div>   
      <div><InputCompany open={open2} handleClose={handleClose}/></div>

      <AuditInfo additionalData={additionalData} />

     </div>
   

  );
}

export default Grid;
